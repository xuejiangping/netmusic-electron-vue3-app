"use strict";const n=require("electron"),a=require("path"),c=require("path");function r(e){const t=new n.Tray(c.join(__dirname,"../src/assets/img/favicon.ico")),i=[{label:"当前歌曲",click(){e.webContents.send("music_detail")}},{label:"播放/暂停",click(){e.webContents.send("playMusic")}},{label:"上一曲",click(){e.webContents.send("prevMusic")}},{label:"下一曲",click(){e.webContents.send("nextMusic")}},{label:"退出",click(){e.close()}}],o=n.Menu.buildFromTemplate(i);return t.setContextMenu(o),t.setToolTip("浮生浪迹笑明月"),t.on("click",()=>e.show()),{tray:t,menu:o}}function d(e){const{tray:t,menu:i}=r(e);n.ipcMain.handle("window_close",()=>e.close()),n.ipcMain.handle("window_min",()=>e.minimize()),n.ipcMain.handle("window_hide",()=>e.hide()),n.ipcMain.handle("window_max",()=>{e.isMaximized()?e.restore():e.maximize()}),n.ipcMain.handle("tray_setContextMenu_musicName",(o,s)=>{i.items[0].label=s,t.setContextMenu(i)}),n.ipcMain.handle("tray_setToolTip",(o,s)=>{t.setToolTip(s)})}process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";const l=()=>{n.Menu.setApplicationMenu(null);const e=new n.BrowserWindow({width:800,height:560,minWidth:650,minHeight:450,frame:!1,title:"网易云音乐",webPreferences:{contextIsolation:!1,nodeIntegration:!0,preload:a.join(__dirname,"../electron-preload/index.ts")}});if(n.app.isPackaged)e.loadFile(a.join(a.join(__dirname,"../index.html")));else{const t="http://localhost:5173/";e.loadURL(process.env.VITE_DEV_SERVER_URL||t)}return e};n.app.whenReady().then(()=>{const e=l();n.globalShortcut.register("CommandOrControl+Shift+i",function(){e.webContents.openDevTools()}),n.app.on("activate",()=>{n.BrowserWindow.getAllWindows().length===0&&l()}),process.env.VITE_DEV_SERVER_URL?e.loadURL(process.env.VITE_DEV_SERVER_URL):e.loadFile("dist/index.html"),d(e)});n.app.on("window-all-closed",()=>{process.platform!=="darwin"&&n.app.quit()});
